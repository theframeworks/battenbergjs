"use strict";module.exports=init=function(){return{MarzipanoViewer:require("./MarzipanoViewer"),DekstopViewer:require("./DesktopViewer"),VRViewer:require("./VRViewer")}};
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var Marzipano=require("marzipano"),_require=require("./utils"),tiledImageSource=_require.tiledImageSource,MarzipanoViewer=function(){function a(e,t,n){_classCallCheck(this,a),this.panoElement=t,this.environment=this.prepareEnvironment(e),this.initialScene=0,this.rotationMaps=this.sceneTransitionRotationMapping(),this.Marzipano=Marzipano,this.screenfull=window.screenfull,this.sceneData=n,this.bowser=this.Marzipano.dependencies.bowser,this.mat4=this.Marzipano.dependencies.glMatrix.mat4,this.quat=this.Marzipano.dependencies.glMatrix.quat,this.believedDesktop=this.isBelievedDesktop(e);var i={controls:{mouseViewMode:this.sceneData.settings.mouseViewMode||!1,scrollZoom:!1}};this.viewer=new this.Marzipano.Viewer(this.panoElement,i),this.currentScene=null,this.defaultView=null,this.currentData={},this.currentContainers=[],this.currentLayers=[]}return _createClass(a,[{key:"setupSceneBehaviour",value:function(e,t){return this.scenes=this.createScenesFromData.call(this,this.sceneData.scenes,e,this.viewer),this.cacheSceneVariables(this.scenes[this.initialScene]),this.scenes}},{key:"deg2rad",value:function(e){return e*Math.PI/180}},{key:"rad2deg",value:function(e){return 180*e/Math.PI}},{key:"isBelievedDesktop",value:function(){return"mobileVR"!==this.environment}},{key:"createScenesFromData",value:function(e,d,l){var u=this;return e.map(function(e,t){var n=tiledImageSource(e.id),i=new u.Marzipano.CubeGeometry(u.sceneData.cubeGeometryLevels),a=d.call(u,l,n,i,e),s=a.scene,o=a.view,c=a.containers,r=a.layers;return{data:a.data,scene:s,containers:c,layers:r,view:o}})}},{key:"cacheSceneVariables",value:function(e){this.currentView=e.view,this.currentScene=e.scene,this.currentContainers=e.containers,this.currentData=e.data,this.currentLayers=e.layers}},{key:"sanitize",value:function(e){return e.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;")}},{key:"createLinkHotspotElement",value:function(e,t){var n=this,i=document.createElement("div");i.classList.add("hotspot"),i.classList.add("link-hotspot");var a=document.createElement("img");a.src="icons/link.svg",a.classList.add("link-hotspot-icon"),i.addEventListener("click",function(){n.currentScene=t.call(n,n.findSceneById(e.target))}),this.stopTouchAndScrollEventPropagation(i);var s=document.createElement("div");s.classList.add("hotspot-tooltip"),s.classList.add("link-hotspot-tooltip"),i.appendChild(a),i.appendChild(s);var o=document.createElement("div");return o.appendChild(i),o}},{key:"createInfoHotspotElement",value:function(e){var t=document.createElement("div");t.setAttribute("data-info-hotspot-container-id",e.id);var n=document.createElement("div");n.classList.add("hotspot"),n.classList.add("info-hotspot");var i=document.createElement("div");i.classList.add("info-hotspot-header"),i.setAttribute("data-info-hotspot-id",e.id);var a=document.createElement("div");a.classList.add("info-hotspot-icon-wrapper"),i.appendChild(a);var s=document.createElement("div");s.classList.add("info-hotspot-content"),s.setAttribute("data-info-hotspot-id",e.id);var o=document.getElementById("hotspot-".concat(e.id));o&&s.appendChild(o.cloneNode(!0)),e.hideInMobile&&(n.classList.add("is-hidden-inline"),s.classList.add("is-hidden-inline")),n.appendChild(i),(this.believedDesktop?this.panoElement:n).appendChild(s);var c=function(e){var t=e.currentTarget.getAttribute("data-info-hotspot-id");e.preventDefault(),document.querySelectorAll('[data-info-hotspot-id="'.concat(t,'"]')).forEach(function(e){e.classList.toggle("is-visible"),e.classList.contains("is-visible")&&document.querySelectorAll('[data-info-hotspot-container-id="'.concat(t,'"]')).forEach(function(e){e.parentNode.appendChild(e)})})};n.querySelector(".info-hotspot-header").addEventListener("click",c);var r=s.querySelector("[data-hotspot-close]");return r&&(r.setAttribute("data-info-hotspot-id",e.id),r.addEventListener("click",c)),this.stopTouchAndScrollEventPropagation(n),t.appendChild(n),t}},{key:"stopTouchAndScrollEventPropagation",value:function(e){for(var t=["touchstart","touchmove","touchend","touchcancel","wheel","mousewheel"],n=0;n<t.length;n++)e.addEventListener(t[n],function(e){e.stopPropagation()})}},{key:"findSceneById",value:function(e){for(var t=0;t<this.scenes.length;t++)if(this.scenes[t].data.id===e)return this.scenes[t];return null}},{key:"findSceneDataById",value:function(e){for(var t=0;t<this.sceneData.scenes.length;t++)if(this.sceneData.scenes[t].id===e)return this.sceneData.scenes[t];return null}},{key:"prepareEnvironment",value:function(e){if(window.matchMedia){var t=function(){n.matches?(document.body.classList.remove("desktop"),document.body.classList.add("mobile")):(document.body.classList.remove("mobile"),document.body.classList.add("desktop"))},n=matchMedia("(max-width: 500px), (max-height: 500px)");t(),n.addListener(t)}else document.body.classList.add("desktop");return e}},{key:"getTransitionRotation",value:function(e,t){return this.rotationMaps.from[e.id].to[t.id]}},{key:"sceneTransitionRotationMapping",value:function(){return{from:{"scene-0":{to:{"scene-0":{yaw:3.8,pitch:.22798880022457624},"scene-1":{yaw:-2.8274448996260446,pitch:.06012930486655321}}},"scene-1":{to:{"scene-0":{yaw:.145253345801045,pitch:.07},"scene-2":{yaw:-.14971585481837835,pitch:.07},"scene-3":{yaw:2.6021574657373403,pitch:.09960663233749756}}},"scene-2":{to:{"scene-1":{yaw:2.432133517575684,pitch:.07}}},"scene-3":{to:{"scene-1":{yaw:-.4469404282362994,pitch:.07244311540308956},"scene-4":{yaw:-1.3994865291876781,pitch:.05190705801597417},"scene-5":{yaw:1.403211200196525,pitch:.07}}},"scene-4":{to:{"scene-3":{yaw:1.0620391999023013,pitch:.07}}},"scene-5":{to:{"scene-3":{yaw:-.5201367601720577,pitch:.11417302060570478}}}}}}}]),a}();
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _get(e,t,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var o=_superPropBase(e,t);if(o){var n=Object.getOwnPropertyDescriptor(o,t);return n.get?n.get.call(r):n.value}})(e,t,r||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var MarzipanoViewer=require("./MarzipanoViewer"),DesktopViewer=function(e){function u(e){var t;_classCallCheck(this,u),(t=_possibleConstructorReturn(this,_getPrototypeOf(u).call(this,"desktop",e,window.sceneDataDesktop))).autorotateData,t.firstLoad=!0,t.autorotateToggleElement=document.querySelector("#autorotateToggle"),t.sceneNameElement=document.querySelector("#titleBar .sceneName");var r=t.setupSceneBehaviour(t.createScene,t.switchScene);return t.switchScene(r[t.initialScene]),t}return _inherits(u,MarzipanoViewer),_createClass(u,[{key:"createScene",value:function(e,t,r,o){var n=this,i=this.Marzipano.RectilinearView.limit.traditional(this.sceneData.faceSize,this.deg2rad(100),this.deg2rad(120)),a=new this.Marzipano.RectilinearView(o.initialViewParameters,i),c=e.createScene({source:t,geometry:r,view:a,pinFirstLevel:!0}),s=c.hotspotContainer();return o.linkHotspots.forEach(function(e){var t=_get(_getPrototypeOf(u.prototype),"createLinkHotspotElement",n).call(n,e,n.switchScene);s.createHotspot(t,{yaw:e.yaw,pitch:e.pitch})}),o.infoHotspots.forEach(function(e){var t=_get(_getPrototypeOf(u.prototype),"createInfoHotspotElement",n).call(n,e,n.panoElement);s.createHotspot(t,{yaw:e.yaw,pitch:e.pitch})}),{scene:c,view:a,data:o}}},{key:"switchScene",value:function(e){var t=this.firstLoad?e.data.initialViewParameters:this.getTransitionRotation(this.currentData,e.data);this.firstLoad=!1,e.view.setParameters(t),this.cacheSceneVariables.call(this,e),e.scene.switchTo()}}]),u}();
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,o=new Array(t.length);e<t.length;e++)o[e]=t[e];return o}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,o){return e&&_defineProperties(t.prototype,e),o&&_defineProperties(t,o),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _get(t,e,o){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,o){var n=_superPropBase(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(o):r.value}})(t,e,o||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var MarzipanoViewer=require("./MarzipanoViewer"),DeviceOrientationStrategy=require("./DeviceOrientationStrategy"),VRViewer=function(t){function f(t){var e;_classCallCheck(this,f),(e=_possibleConstructorReturn(this,_getPrototypeOf(f).call(this,"mobileVR",t,window.sceneDataVR))).gyroEnabled,e.viewingTimeoutID=null,e.currentHotspotCandidate=null,e.openedHotspot=null,e.previousFrameRotation={yaw:0,pitch:0,roll:0},e.sceneEntryViewDirection=null,e.lookTriggerThreshold=1500,e.openPopupRadianThreshhold=e.deg2rad(5),e.closePopupHorizontalRadianThreshholdPerColumn=e.deg2rad(15),e.orientationMethodID="deviceOrientation",e.deviceOrientationControlFunction=DeviceOrientationStrategy,e.deviceOrientationController;var o=e.setupSceneBehaviour(e.createScene,e.switchScene);return e.setupGyroControls(o),e.switchScene(o[e.initialScene]),e}return _inherits(f,MarzipanoViewer),_createClass(f,[{key:"createScene",value:function(r,t,e,i){var a=this,s=r.stage(),l={source:t,geometry:e,textureStoreOpts:{previouslyVisibleCacheSize:32},layerOpts:{effects:null}},c=[],u=[],p=new this.Marzipano.RectilinearView(i.initialViewParameters),h=r.createEmptyScene({view:p});[{rect:{relativeWidth:.5,relativeX:0}},{rect:{relativeWidth:.5,relativeX:.5}}].forEach(function(t,e){l.layerOpts.effects=t;var o=h.createLayer(l);o.eyeSide=0===e?"left":"right";var n=new a.Marzipano.HotspotContainer(r.domElement(),s,p,r.renderLoop(),t);i.linkHotspots.forEach(function(t){var e=_get(_getPrototypeOf(f.prototype),"createLinkHotspotElement",a).call(a,t,a.switchScene);e.dataset.hotspot_target=t.target,n.createHotspot(e,{yaw:t.yaw,pitch:t.pitch})}),i.infoHotspots.forEach(function(t){if(!t.hideInVR){var e=_get(_getPrototypeOf(f.prototype),"createInfoHotspotElement",a).call(a,t,o);e.dataset.hotspot_target=t.id,n.createHotspot(e,{yaw:t.yaw,pitch:t.pitch})}}),n.hide(),c.push(n),u.push(o)}),"scene-0"===i.id&&this.showHotspotZero(c);var o=i.infoHotspots.filter(function(t){return!1===Object.keys(t).includes("hideInVR")}).filter(function(t){return"0"!==t.id}).map(function(t){return{yaw:t.yaw,pitch:t.pitch,target:t.id,columns:t.columns||1}}),n=i.linkHotspots.map(function(t){return{yaw:t.yaw,pitch:t.pitch,target:t.target}});return i.vrCollisionData=_toConsumableArray(o).concat(_toConsumableArray(n)),i.firstLoad=!0,{scene:h,view:p,containers:c,layers:u,data:i}}},{key:"showHotspotZero",value:function(t){var e=this.getHotspotsFromHotspotTarget(t,"0"),o=e.leftHotspot,n=(e.rightHotspot,o.domElement());this.clickInfoHotspot(n)}},{key:"switchScene",value:function(t){this.currentContainers.forEach(function(t){t.hide()}),t.containers.forEach(function(t){t.show()}),clearTimeout(this.viewingTimeoutID),this.viewingTimeoutID=null;var e=this.getTransitionRotation(this.currentData,t.data);t.view.setParameters(e),this.cacheSceneVariables.call(this,t),t.scene.switchTo({},function(){})}},{key:"setupGyroControls",value:function(t){var o=this;this.Marzipano.dependencies.eventEmitter(this.deviceOrientationControlFunction),this.deviceOrientationController=new this.deviceOrientationControlFunction;this.viewer.controls().registerMethod(this.orientationMethodID,this.deviceOrientationController,!0),this.deviceOrientationController.addEventListener("updatedYawPitchRoll",function(t,e){o.computeLookDirection.call(o,e,o.currentScene,o.currentView)})}},{key:"setTimerClass",value:function(t){this.panoElement.classList.toggle("is-opening",t)}},{key:"clickInfoHotspot",value:function(t){t.querySelector(".info-hotspot-header").click()}},{key:"clickLinkHotspot",value:function(t){t.querySelector(".link-hotspot").click()}},{key:"clampOverflowRotation",value:function(t){var e=2*Math.PI,o=(t+Math.PI)%e;return o<0&&(o+=e),o-Math.PI}},{key:"minimumLookAtBounds",value:function(t,e){var o=t.yaw-e.yaw,n=t.pitch-e.pitch;return{yawDiff:o,pitchDiff:n,lookAtUpperBound:o<this.openPopupRadianThreshhold&&n<this.openPopupRadianThreshhold,lookAtLowerBound:o>-this.openPopupRadianThreshhold&&n>-this.openPopupRadianThreshhold}}},{key:"minimumLookAwayBounds",value:function(t,e){var o=this.clampOverflowRotation(t.yaw-e.yaw);return{yawDiff:o,lookAwayMinimumUpperBound:o>this.closePopupHorizontalRadianThreshholdPerColumn*t.columns,lookAwayMinimumLowerBound:o<-this.closePopupHorizontalRadianThreshholdPerColumn*t.columns}}},{key:"computeLookDirection",value:function(t,e,o){var i=this,a=o.parameters();if(this.currentHotspotCandidate||this.openedHotspot){if(this.currentHotspotCandidate&&!this.openedHotspot){var n=this.currentHotspotCandidate,r=this.minimumLookAtBounds(n,a),s=(r.yawDiff,r.pitchDiff,r.lookAtUpperBound),l=r.lookAtLowerBound;if(!s||!l)return clearTimeout(this.viewingTimeoutID),this.viewingTimeoutID=null,this.openedHotspot=null,this.currentHotspotCandidate=null,void this.setTimerClass(!1)}else if(this.openedHotspot){var c=this.openedHotspot,u=this.minimumLookAwayBounds(c,a),p=(u.yawDiff,u.lookAwayMinimumUpperBound);if(u.lookAwayMinimumLowerBound||p){var h=this.getHotspotsFromHotspotTarget(this.currentContainers,c.target),f=h.leftHotspot,d=(h.rightHotspot,f.domElement());this.clickInfoHotspot(d),clearTimeout(this.viewingTimeoutID),this.viewingTimeoutID=null,this.openedHotspot=null}}}else for(var y=this.currentData.vrCollisionData,m=function(t){if(i.currentHotspotCandidate)return"continue";var n=y[t],e=i.minimumLookAtBounds(n,a),o=(e.yawDiff,e.pitchDiff,e.lookAtUpperBound),r=e.lookAtLowerBound;o&&r&&(i.currentHotspotCandidate=n,i.viewingTimeoutID||(i.setTimerClass(!0),i.viewingTimeoutID=setTimeout(function(){var t=i.getHotspotsFromHotspotTarget(i.currentContainers,i.currentHotspotCandidate.target),e=t.leftHotspot,o=(t.rightHotspot,e.domElement());i.setTimerClass(!1),i.viewingTimeoutID=null,o.dataset.hotspot_target.includes("scene")?(i.openedHotspot=null,i.clickLinkHotspot(o)):(i.openedHotspot=n,i.clickInfoHotspot(o))},i.lookTriggerThreshold)))},v=0;v<y.length;v++)m(v)}},{key:"getHotspotsFromHotspotTarget",value:function(t,e){for(var o=_toConsumableArray(t[0].listHotspots()),n=0;n<o.length;n++){if(o[n].domElement().dataset.hotspot_target==e)return{leftHotspot:o[n],rightHotspot:t[1].listHotspots()[n]}}console.error("no hotspot found?")}}]),f}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIiwiTWFyemlwYW5vVmlld2VyLmpzIiwiRGVza3RvcFZpZXdlci5qcyIsIlZSVmlld2VyLmpzIl0sIm5hbWVzIjpbIm1vZHVsZSIsImV4cG9ydHMiLCJpbml0IiwicmVxdWlyZSIsIkRla3N0b3BWaWV3ZXIiLCJNYXJ6aXBhbm9WaWV3ZXIiLCJNYXJ6aXBhbm8iLCJ0aWxlZEltYWdlU291cmNlIiwicGFub0VsZW1lbnQiLCJzY2VuZURhdGEiLCJfY2xhc3NDYWxsQ2hlY2siLCJ0aGlzIiwicHJlcGFyZUVudmlyb25tZW50IiwiZW52aXJvbm1lbnQiLCJpbml0aWFsU2NlbmUiLCJyb3RhdGlvbk1hcHMiLCJzY2VuZVRyYW5zaXRpb25Sb3RhdGlvbk1hcHBpbmciLCJzY3JlZW5mdWxsIiwid2luZG93IiwiYm93c2VyIiwibWF0NCIsImRlcGVuZGVuY2llcyIsImdsTWF0cml4IiwicXVhdCIsIm1vdXNlVmlld01vZGUiLCJzY3JvbGxab29tIiwiY29udHJvbHMiLCJWaWV3ZXIiLCJ2aWV3ZXJPcHRzIiwiY3VycmVudERhdGEiLCJjdXJyZW50Q29udGFpbmVycyIsImN1cnJlbnRMYXllcnMiLCJzY2VuZUNyZWF0b3IiLCJzY2VuZVN3aXRjaGVyIiwic2NlbmVzIiwiY3JlYXRlU2NlbmVzRnJvbURhdGEiLCJjYWxsIiwidmlld2VyIiwiY2FjaGVTY2VuZVZhcmlhYmxlcyIsImRlZyIsIk1hdGgiLCJQSSIsInJhZCIsIl9kYXRhIiwiY3JlYXRlU2NlbmUiLCJfdGhpcyIsIm1hcCIsIm1EYXRhIiwiaSIsInNvdXJjZSIsImlkIiwiZ2VvbWV0cnkiLCJDdWJlR2VvbWV0cnkiLCJjdWJlR2VvbWV0cnlMZXZlbHMiLCJfY3JlYXRlU2NlbmUkY2FsbCIsInNjZW5lIiwidmlldyIsImNvbnRhaW5lcnMiLCJsYXllcnMiLCJkYXRhIiwiY3VycmVudFNjZW5lIiwicyIsImN1cnJlbnRWaWV3IiwicmVwbGFjZSIsIl90aGlzMiIsIndyYXBwZXIiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJpY29uIiwic3JjIiwic3dpdGNoU2NlbmUiLCJmaW5kU2NlbmVCeUlkIiwiaG90c3BvdCIsInRhcmdldCIsInRvb2x0aXAiLCJzdG9wVG91Y2hBbmRTY3JvbGxFdmVudFByb3BhZ2F0aW9uIiwiYXBwZW5kQ2hpbGQiLCJjb250YWluZXIiLCJzZXRBdHRyaWJ1dGUiLCJoZWFkZXIiLCJpY29uV3JhcHBlciIsImNvbnRlbnQiLCJob3RzcG90RWxlbSIsImdldEVsZW1lbnRCeUlkIiwiY29uY2F0IiwiaGlkZUluTW9iaWxlIiwiY2xvbmVOb2RlIiwiY3VycmVudFRhcmdldCIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJ0b2dnbGUiLCJlbGVtZW50IiwiZ2V0QXR0cmlidXRlIiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJxdWVyeVNlbGVjdG9yIiwiY29udGFpbnMiLCJwYXJlbnROb2RlIiwiYWRkRXZlbnRMaXN0ZW5lciIsImNsb3NlSWNvbiIsImV2ZW50TGlzdCIsImxlbmd0aCIsInN0b3BQcm9wYWdhdGlvbiIsIm1hdGNoZXMiLCJzZXRNb2RlIiwibXFsIiwiYm9keSIsInJlbW92ZSIsImFkZExpc3RlbmVyIiwibWF0Y2hNZWRpYSIsImVudiIsImZyb20iLCJ0byIsInNjZW5lLTAiLCJ5YXciLCJwaXRjaCIsInNjZW5lLTEiLCJzY2VuZS0yIiwic2NlbmUtMyIsInNjZW5lLTQiLCJzY2VuZS01IiwiRGVza3RvcFZpZXdlciIsIl9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuIiwiX2dldFByb3RvdHlwZU9mIiwic2NlbmVEYXRhRGVza3RvcCIsImF1dG9yb3RhdGVEYXRhIiwiZmlyc3RMb2FkIiwiYXV0b3JvdGF0ZVRvZ2dsZUVsZW1lbnQiLCJzY2VuZU5hbWVFbGVtZW50IiwiZ3JvdXBlZFNjZW5lRGF0YSIsInNldHVwU2NlbmVCZWhhdmlvdXIiLCJsaW1pdGVyIiwiUmVjdGlsaW5lYXJWaWV3IiwibGltaXQiLCJ0cmFkaXRpb25hbCIsImRlZzJyYWQiLCJpbml0aWFsVmlld1BhcmFtZXRlcnMiLCJwaW5GaXJzdExldmVsIiwiaG90c3BvdENvbnRhaW5lciIsIl9nZXQiLCJwcm90b3R5cGUiLCJjcmVhdGVIb3RzcG90IiwiaW5mb0hvdHNwb3RzIiwiYWx0ZXJlZFZpZXdQYXJhbXMiLCJnZXRUcmFuc2l0aW9uUm90YXRpb24iLCJsaW5rSG90c3BvdHMiLCJzd2l0Y2hUbyIsIkRldmljZU9yaWVudGF0aW9uU3RyYXRlZ3kiLCJWUlZpZXdlciIsInNjZW5lRGF0YVZSIiwiZ3lyb0VuYWJsZWQiLCJ2aWV3aW5nVGltZW91dElEIiwiY3VycmVudEhvdHNwb3RDYW5kaWRhdGUiLCJvcGVuZWRIb3RzcG90IiwicHJldmlvdXNGcmFtZVJvdGF0aW9uIiwicm9sbCIsInNjZW5lRW50cnlWaWV3RGlyZWN0aW9uIiwibG9va1RyaWdnZXJUaHJlc2hvbGQiLCJvcGVuUG9wdXBSYWRpYW5UaHJlc2hob2xkIiwiY2xvc2VQb3B1cEhvcml6b250YWxSYWRpYW5UaHJlc2hob2xkUGVyQ29sdW1uIiwib3JpZW50YXRpb25NZXRob2RJRCIsImRldmljZU9yaWVudGF0aW9uQ29udHJvbEZ1bmN0aW9uIiwiZGV2aWNlT3JpZW50YXRpb25Db250cm9sbGVyIiwic2V0dXBHeXJvQ29udHJvbHMiLCJzdGFnZSIsInRleHR1cmVTdG9yZU9wdHMiLCJwcmV2aW91c2x5VmlzaWJsZUNhY2hlU2l6ZSIsImxheWVyT3B0cyIsImVmZmVjdHMiLCJlbXB0eVZpZXciLCJyZWN0IiwicmVsYXRpdmVXaWR0aCIsInJlbGF0aXZlWCIsImxheWVyIiwiY3JlYXRlTGF5ZXIiLCJvcHRzIiwiZXllU2lkZSIsImluZGV4IiwiSG90c3BvdENvbnRhaW5lciIsImRvbUVsZW1lbnQiLCJyZW5kZXJMb29wIiwibGVmdFJpZ2h0UmVjdHMiLCJob3RzcG90RGF0YSIsImRhdGFzZXQiLCJob3RzcG90X3RhcmdldCIsImhpZGVJblZSIiwiaGlkZSIsInB1c2giLCJzaG93SG90c3BvdFplcm8iLCJmaWx0ZXIiLCJpaCIsIk9iamVjdCIsImtleXMiLCJpbmNsdWRlcyIsImxoIiwidnJDb2xsaXNpb25EYXRhIiwiX3RvQ29uc3VtYWJsZUFycmF5IiwiaW5mb0RhdGEiLCJsaW5rRGF0YSIsIl90aGlzJGdldEhvdHNwb3RzRnJvbSIsImdldEhvdHNwb3RzRnJvbUhvdHNwb3RUYXJnZXQiLCJsZWZ0SG90c3BvdCIsInJpZ2h0SG90c3BvdCIsImNsaWNrSW5mb0hvdHNwb3QiLCJsZWZ0RWxlbWVudCIsImMiLCJzaG93IiwiY2xlYXJUaW1lb3V0IiwiY29sdW1ucyIsIl90aGlzMyIsImV2ZW50RW1pdHRlciIsInJlZ2lzdGVyTWV0aG9kIiwiXyIsInJvdGF0aW9uIiwiY29tcHV0ZUxvb2tEaXJlY3Rpb24iLCJvbiIsImNsaWNrIiwic2V0UGFyYW1ldGVycyIsInBpMiIsImluc3RhbnRFbmFibGUiLCJyYWRpYW4iLCJzcG90IiwicGFyYW1zIiwieWF3RGlmZiIsInBpdGNoRGlmZiIsImxvb2tBdFVwcGVyQm91bmQiLCJsb29rQXRMb3dlckJvdW5kIiwiY2xhbXBPdmVyZmxvd1JvdGF0aW9uIiwiX3RoaXM0IiwicGFyYW1ldGVycyIsImhvdHNwb3RzIiwiX3RoaXMkbWluaW11bUxvb2tBdEJvIiwibWluaW11bUxvb2tBdEJvdW5kcyIsIm1pbmltdW1Mb29rQXdheUJvdW5kcyIsImxvb2tBd2F5TWluaW11bVVwcGVyQm91bmQiLCJsb29rQXdheU1pbmltdW1Mb3dlckJvdW5kIiwiX2xvb3AiLCJfdGhpczQkbWluaW11bUxvb2tBdEIiLCJzZXRUaW1lb3V0IiwiX3RoaXM0JGdldEhvdHNwb3RzRnJvIiwiY2xpY2tMaW5rSG90c3BvdCIsImxpc3RIb3RzcG90cyIsImNvbnNvbGUiLCJlcnJvciJdLCJtYXBwaW5ncyI6ImFBQUFBLE9BQU9DLFFBQVVDLEtBQU8sV0FDcEIsTUFBTyxDQURKRCxnQkFBaUJFLFFBQUEscUJBQ3BCQyxjQUFPRCxRQUFBLG1CQUNIRSxTQUFBQSxRQUFpQkY7bVpDRnpCLElB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QUFBMEIsRUFBQWxDLG1CQUFLM0MsRUFBTCxHQUFxQm9FLGdCQUNyQi9LLEVBQUEsRUFBSUEsRUFBQzZKLEVBQUFBLE9BQWlCQyxJQUFBQSxDQUdqQyxHQUZRMEIsRUFBQXhMLEdBQUFxSSxhQUVSSSxRQUFBQyxnQkFBQS9HLEVBdURMLE1BQU8sQ0FBRWdJLFlBdERSNkIsRUFBQXhMLEdBc0QyQjRKLGFBckdzQm5KLEVBQUEsR0FBQTBMLGVBQUFuTSxJQWdEckRvTSxRQUFBQyxNQUFBIiwiZmlsZSI6ImJhdHRlbmJ1cmcuanMiLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUuZXhwb3J0cyA9IGluaXQgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgTWFyemlwYW5vVmlld2VyOiByZXF1aXJlKCcuL01hcnppcGFub1ZpZXdlcicpLFxuICAgICAgICBEZWtzdG9wVmlld2VyOiByZXF1aXJlKCcuL0Rlc2t0b3BWaWV3ZXInKSxcbiAgICAgICAgVlJWaWV3ZXI6IHJlcXVpcmUoJy4vVlJWaWV3ZXInKVxuICAgIH1cbn0iLCJjb25zdCBNYXJ6aXBhbm8gPSByZXF1aXJlKCdtYXJ6aXBhbm8nKTtcbmNvbnN0IHsgdGlsZWRJbWFnZVNvdXJjZSB9ID0gcmVxdWlyZSgnLi91dGlscycpO1xuXG5jbGFzcyBNYXJ6aXBhbm9WaWV3ZXIge1xuXG4gICAgLyoqXG4gICAgICogXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGVudmlyb25tZW50IFxuICAgICAqIEBwYXJhbSB7RWxlbWVudH0gcGFub0VsZW1lbnQgLSBJbmplY3RlZCBieSB0aGUgdmlld1N3aXRjaCBmaWxlIHdpdGggZWl0aGVyIHRoZSBWUiBvciBEZXNrdG9wIHBhbm9FbGVtZW50XG4gICAgICovXG4gICAgY29uc3RydWN0b3IoZW52aXJvbm1lbnQsIHBhbm9FbGVtZW50LCBzY2VuZURhdGEpIHtcblxuICAgICAgICB0aGlzLnBhbm9FbGVtZW50ID0gcGFub0VsZW1lbnQ7XG4gICAgICAgIHRoaXMuZW52aXJvbm1lbnQgPSB0aGlzLnByZXBhcmVFbnZpcm9ubWVudChlbnZpcm9ubWVudCk7XG4gICAgICAgIHRoaXMuaW5pdGlhbFNjZW5lID0gMDtcbiAgICAgICAgdGhpcy5yb3RhdGlvbk1hcHMgPSB0aGlzLnNjZW5lVHJhbnNpdGlvblJvdGF0aW9uTWFwcGluZygpO1xuXG4gICAgICAgIHRoaXMuTWFyemlwYW5vID0gTWFyemlwYW5vO1xuICAgICAgICB0aGlzLnNjcmVlbmZ1bGwgPSB3aW5kb3cuc2NyZWVuZnVsbDtcbiAgICAgICAgdGhpcy5zY2VuZURhdGEgPSBzY2VuZURhdGE7XG5cbiAgICAgICAgdGhpcy5ib3dzZXIgPSB0aGlzLk1hcnppcGFuby5kZXBlbmRlbmNpZXMuYm93c2VyO1xuICAgICAgICB0aGlzLm1hdDQgPSB0aGlzLk1hcnppcGFuby5kZXBlbmRlbmNpZXMuZ2xNYXRyaXgubWF0NDtcbiAgICAgICAgdGhpcy5xdWF0ID0gdGhpcy5NYXJ6aXBhbm8uZGVwZW5kZW5jaWVzLmdsTWF0cml4LnF1YXQ7XG5cbiAgICAgICAgdGhpcy5iZWxpZXZlZERlc2t0b3AgPSB0aGlzLmlzQmVsaWV2ZWREZXNrdG9wKGVudmlyb25tZW50KTtcblxuICAgICAgICAvLyBWaWV3ZXIgb3B0aW9ucy4gQ2hvaWNlcyBoZXJlOiBodHRwOi8vd3d3Lm1hcnppcGFuby5uZXQvcmVmZXJlbmNlL2dsb2JhbC5odG1sI3JlZ2lzdGVyRGVmYXVsdENvbnRyb2xzXG4gICAgICAgIGxldCB2aWV3ZXJPcHRzID0ge1xuICAgICAgICAgICAgY29udHJvbHM6IHtcbiAgICAgICAgICAgICAgICAvLyBXZSdsbCBkZWZhdWx0IHRvIG1vdXNlL3BvaW50ZXIgY29udHJvbCwgSSBjYW4gdHVybiBvbiBWUiBneXJvIGNvbnRyb2wgb24gdXNlciBkZW1hbmQuXG4gICAgICAgICAgICAgICAgbW91c2VWaWV3TW9kZTogdGhpcy5zY2VuZURhdGEuc2V0dGluZ3MubW91c2VWaWV3TW9kZSB8fCBmYWxzZSxcbiAgICAgICAgICAgICAgICBzY3JvbGxab29tOiBmYWxzZSxcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBJbml0aWFsaXplIHZpZXdlci5cbiAgICAgICAgdGhpcy52aWV3ZXIgPSBuZXcgdGhpcy5NYXJ6aXBhbm8uVmlld2VyKHRoaXMucGFub0VsZW1lbnQsIHZpZXdlck9wdHMpO1xuXG4gICAgICAgIHRoaXMuY3VycmVudFNjZW5lID0gbnVsbDtcbiAgICAgICAgdGhpcy5kZWZhdWx0VmlldyA9IG51bGw7XG4gICAgICAgIHRoaXMuY3VycmVudERhdGEgPSB7fTtcbiAgICAgICAgdGhpcy5jdXJyZW50Q29udGFpbmVycyA9IFtdO1xuICAgICAgICB0aGlzLmN1cnJlbnRMYXllcnMgPSBbXTtcbiAgICB9XG5cblxuICAgIHNldHVwU2NlbmVCZWhhdmlvdXIoc2NlbmVDcmVhdG9yLCBzY2VuZVN3aXRjaGVyKSB7XG5cbiAgICAgICAgLy8gQ3JlYXRlIHNjZW5lcyB1c2luZyB0aGUgcHJvdmlkZWQgZGF0YSBqc29uXG4gICAgICAgIHRoaXMuc2NlbmVzID0gdGhpcy5jcmVhdGVTY2VuZXNGcm9tRGF0YS5jYWxsKHRoaXMsIHRoaXMuc2NlbmVEYXRhLnNjZW5lcywgc2NlbmVDcmVhdG9yLCB0aGlzLnZpZXdlcik7XG5cbiAgICAgICAgdGhpcy5jYWNoZVNjZW5lVmFyaWFibGVzKHRoaXMuc2NlbmVzW3RoaXMuaW5pdGlhbFNjZW5lXSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuc2NlbmVzO1xuICAgIH1cblxuICAgIC8vIERvIEkgbmVlZCB0byBtYWtlIHRoZXNlIDE4MHMgYXMgZmxvYXRzP1xuICAgIC8vIEpTIG9ubHkgaGFzIHRoZSBOdW1iZXIgdHlwZSBmb3IgYWxsIG51bWJlcnMgdGhvdWdoLCBwcm9iYWJseSBub3QgYW4gaXNzdWUuXG4gICAgZGVnMnJhZChkZWcpIHtcbiAgICAgICAgcmV0dXJuIGRlZyAqIE1hdGguUEkgLyAxODA7XG4gICAgfVxuXG4gICAgcmFkMmRlZyhyYWQpIHtcbiAgICAgICAgcmV0dXJuIHJhZCAqIDE4MCAvIE1hdGguUEk7XG4gICAgfVxuXG4gICAgaXNCZWxpZXZlZERlc2t0b3AoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmVudmlyb25tZW50ICE9PSAnbW9iaWxlVlInO1xuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogXG4gICAgICogQHBhcmFtIHtbXX0gX2RhdGEgXG4gICAgICogQHBhcmFtIHsoKSA9PiB7fX0gc2NlbmVDcmVhdG9yIFxuICAgICAqL1xuICAgIGNyZWF0ZVNjZW5lc0Zyb21EYXRhKF9kYXRhLCBjcmVhdGVTY2VuZSwgdmlld2VyKSB7XG5cbiAgICAgICAgcmV0dXJuIF9kYXRhLm1hcCgobURhdGEsIGkpID0+IHtcblxuICAgICAgICAgICAgLy8gWzFdIGdldCB0aGUgaW1hZ2VzXG4gICAgICAgICAgICBjb25zdCBzb3VyY2UgPSB0aWxlZEltYWdlU291cmNlKG1EYXRhLmlkKTtcblxuICAgICAgICAgICAgLy8gWzJdIENyZWF0ZSB0aGUgZ2VvbWV0cnlcbiAgICAgICAgICAgIGxldCBnZW9tZXRyeSA9IG5ldyB0aGlzLk1hcnppcGFuby5DdWJlR2VvbWV0cnkodGhpcy5zY2VuZURhdGEuY3ViZUdlb21ldHJ5TGV2ZWxzKTtcblxuICAgICAgICAgICAgLy8gVE9ETzogTWF5YmUgbW92ZSB0aGUgZ3JvdXBlZFNjZW5lRGF0YSByZXR1cm4gb2JqZWN0IGludG8gaXQuXG4gICAgICAgICAgICAvLyBUaGVuIGRlc2t0b3AgY2FuIHJldHVybiBTY2VuZSBhbmQgVlIgY2FuIHJldHVybiBTdGFnZS4gRG9lcyBpdCBldmVuIG1hdHRlciB0aG91Z2g/XG4gICAgICAgICAgICBjb25zdCB7IHNjZW5lLCB2aWV3LCBjb250YWluZXJzLCBsYXllcnMsIGRhdGEgfSA9IGNyZWF0ZVNjZW5lLmNhbGwodGhpcywgdmlld2VyLCBzb3VyY2UsIGdlb21ldHJ5LCBtRGF0YSk7XG5cbiAgICAgICAgICAgIGNvbnN0IGdyb3VwZWRTY2VuZURhdGEgPSB7XG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgICAgICBzY2VuZTogc2NlbmUsXG4gICAgICAgICAgICAgICAgY29udGFpbmVyczogY29udGFpbmVycyxcbiAgICAgICAgICAgICAgICBsYXllcnM6IGxheWVycyxcbiAgICAgICAgICAgICAgICB2aWV3OiB2aWV3XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXR1cm4gZ3JvdXBlZFNjZW5lRGF0YTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG5cbiAgICBjYWNoZVNjZW5lVmFyaWFibGVzKHNjZW5lKSB7XG5cbiAgICAgICAgLy8gLy8gRG91YnQgSSdsbCBuZWVkIHRoaXMuIENvdWxkIHByb3ZlIHVzZWZ1bCBmb3Igc29tZSBsYXllciBtYW5pcHVsYXRpb24gdGhvdWdoP1xuICAgICAgICB0aGlzLmN1cnJlbnRWaWV3ID0gc2NlbmUudmlldztcbiAgICAgICAgdGhpcy5jdXJyZW50U2NlbmUgPSBzY2VuZS5zY2VuZTtcbiAgICAgICAgdGhpcy5jdXJyZW50Q29udGFpbmVycyA9IHNjZW5lLmNvbnRhaW5lcnM7XG4gICAgICAgIHRoaXMuY3VycmVudERhdGEgPSBzY2VuZS5kYXRhO1xuICAgICAgICB0aGlzLmN1cnJlbnRMYXllcnMgPSBzY2VuZS5sYXllcnM7XG4gICAgfVxuXG5cbiAgICBzYW5pdGl6ZShzKSB7XG4gICAgICAgIHJldHVybiBzLnJlcGxhY2UoJyYnLCAnJmFtcDsnKS5yZXBsYWNlKCc8JywgJyZsdDsnKS5yZXBsYWNlKCc+JywgJyZndDsnKTtcbiAgICB9XG5cblxuICAgIGNyZWF0ZUxpbmtIb3RzcG90RWxlbWVudChob3RzcG90LCBzd2l0Y2hTY2VuZSkge1xuXG4gICAgICAgIC8vIENyZWF0ZSB3cmFwcGVyIGVsZW1lbnQgdG8gaG9sZCBpY29uIGFuZCB0b29sdGlwLlxuICAgICAgICBsZXQgd3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB3cmFwcGVyLmNsYXNzTGlzdC5hZGQoJ2hvdHNwb3QnKTtcbiAgICAgICAgd3JhcHBlci5jbGFzc0xpc3QuYWRkKCdsaW5rLWhvdHNwb3QnKTtcblxuICAgICAgICAvLyBDcmVhdGUgaW1hZ2UgZWxlbWVudC5cbiAgICAgICAgbGV0IGljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgICAgICAgaWNvbi5zcmMgPSAnaWNvbnMvbGluay5zdmcnO1xuICAgICAgICBpY29uLmNsYXNzTGlzdC5hZGQoJ2xpbmstaG90c3BvdC1pY29uJyk7XG5cbiAgICAgICAgLy8gQWRkIGNsaWNrIGV2ZW50IGhhbmRsZXIuXG4gICAgICAgIHdyYXBwZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRTY2VuZSA9IHN3aXRjaFNjZW5lLmNhbGwodGhpcywgdGhpcy5maW5kU2NlbmVCeUlkKGhvdHNwb3QudGFyZ2V0KSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFByZXZlbnQgdG91Y2ggYW5kIHNjcm9sbCBldmVudHMgZnJvbSByZWFjaGluZyB0aGUgcGFyZW50IGVsZW1lbnQuXG4gICAgICAgIC8vIFRoaXMgcHJldmVudHMgdGhlIHZpZXcgY29udHJvbCBsb2dpYyBmcm9tIGludGVyZmVyaW5nIHdpdGggdGhlIGhvdHNwb3QuXG4gICAgICAgIHRoaXMuc3RvcFRvdWNoQW5kU2Nyb2xsRXZlbnRQcm9wYWdhdGlvbih3cmFwcGVyKTtcblxuICAgICAgICAvLyBDcmVhdGUgdG9vbHRpcCBlbGVtZW50LlxuICAgICAgICBsZXQgdG9vbHRpcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0b29sdGlwLmNsYXNzTGlzdC5hZGQoJ2hvdHNwb3QtdG9vbHRpcCcpO1xuICAgICAgICB0b29sdGlwLmNsYXNzTGlzdC5hZGQoJ2xpbmstaG90c3BvdC10b29sdGlwJyk7XG5cbiAgICAgICAgd3JhcHBlci5hcHBlbmRDaGlsZChpY29uKTtcbiAgICAgICAgd3JhcHBlci5hcHBlbmRDaGlsZCh0b29sdGlwKTtcblxuICAgICAgICBsZXQgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh3cmFwcGVyKTtcblxuICAgICAgICByZXR1cm4gY29udGFpbmVyO1xuICAgIH1cblxuXG4gICAgY3JlYXRlSW5mb0hvdHNwb3RFbGVtZW50KGhvdHNwb3QpIHtcblxuICAgICAgICBsZXQgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2RhdGEtaW5mby1ob3RzcG90LWNvbnRhaW5lci1pZCcsIGhvdHNwb3QuaWQpO1xuXG4gICAgICAgIC8vIENyZWF0ZSB3cmFwcGVyIGVsZW1lbnQgdG8gaG9sZCBpY29uIGFuZCB0b29sdGlwLlxuICAgICAgICBsZXQgd3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB3cmFwcGVyLmNsYXNzTGlzdC5hZGQoJ2hvdHNwb3QnKTtcbiAgICAgICAgd3JhcHBlci5jbGFzc0xpc3QuYWRkKCdpbmZvLWhvdHNwb3QnKTtcblxuICAgICAgICAvLyBDcmVhdGUgaG90c3BvdC90b29sdGlwIGhlYWRlci5cbiAgICAgICAgbGV0IGhlYWRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBoZWFkZXIuY2xhc3NMaXN0LmFkZCgnaW5mby1ob3RzcG90LWhlYWRlcicpO1xuICAgICAgICBoZWFkZXIuc2V0QXR0cmlidXRlKCdkYXRhLWluZm8taG90c3BvdC1pZCcsIGhvdHNwb3QuaWQpO1xuXG4gICAgICAgIC8vIENyZWF0ZSBpbWFnZSBlbGVtZW50IGZvciB0aGUgbGl0dGxlIGljb24uXG4gICAgICAgIGxldCBpY29uV3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBpY29uV3JhcHBlci5jbGFzc0xpc3QuYWRkKCdpbmZvLWhvdHNwb3QtaWNvbi13cmFwcGVyJyk7XG5cbiAgICAgICAgLy8gQ29uc3RydWN0IGhlYWRlciBlbGVtZW50LlxuICAgICAgICBoZWFkZXIuYXBwZW5kQ2hpbGQoaWNvbldyYXBwZXIpO1xuXG4gICAgICAgIC8vIEFkZCBjb250ZW50IHRvIHRoZSBjb250ZW50IGNvbnRhaW5lclxuICAgICAgICBsZXQgY29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBjb250ZW50LmNsYXNzTGlzdC5hZGQoJ2luZm8taG90c3BvdC1jb250ZW50Jyk7XG4gICAgICAgIGNvbnRlbnQuc2V0QXR0cmlidXRlKCdkYXRhLWluZm8taG90c3BvdC1pZCcsIGhvdHNwb3QuaWQpO1xuXG4gICAgICAgIGxldCBob3RzcG90RWxlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBob3RzcG90LSR7aG90c3BvdC5pZH1gKTtcbiAgICAgICAgaWYgKGhvdHNwb3RFbGVtKSB7XG4gICAgICAgICAgICBjb250ZW50LmFwcGVuZENoaWxkKGhvdHNwb3RFbGVtLmNsb25lTm9kZSh0cnVlKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaG90c3BvdC5oaWRlSW5Nb2JpbGUpIHtcbiAgICAgICAgICAgIHdyYXBwZXIuY2xhc3NMaXN0LmFkZCgnaXMtaGlkZGVuLWlubGluZScpO1xuICAgICAgICAgICAgY29udGVudC5jbGFzc0xpc3QuYWRkKCdpcy1oaWRkZW4taW5saW5lJyk7XG4gICAgICAgIH1cblxuXG4gICAgICAgIC8vIFBsYWNlIGhlYWRlciBpbnRvIHdyYXBwZXIgZWxlbWVudC5cbiAgICAgICAgd3JhcHBlci5hcHBlbmRDaGlsZChoZWFkZXIpO1xuICAgICAgICAodGhpcy5iZWxpZXZlZERlc2t0b3AgPyB0aGlzLnBhbm9FbGVtZW50IDogd3JhcHBlcikuYXBwZW5kQ2hpbGQoY29udGVudCk7XG5cblxuXG4gICAgICAgIGxldCB0b2dnbGUgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGxldCBpZCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLWluZm8taG90c3BvdC1pZCcpO1xuXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGBbZGF0YS1pbmZvLWhvdHNwb3QtaWQ9XCIke2lkfVwiXWApLmZvckVhY2goZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC50b2dnbGUoJ2lzLXZpc2libGUnKTtcblxuICAgICAgICAgICAgICAgIC8vIHJlYXBwZW5kaW5nIHRoZSBvcGVuIGhvdHNwb3QgYnJpbmdzIGl0IG9uIHRvcCBvZiBvdGhlciBob3RzcG90c1xuICAgICAgICAgICAgICAgIC8vIHBsYXlpbmcgd2l0aCB6LWluZGV4IHdvdWxkbid0IHdvcmsgYXMgd2UgYXJlIGRlYWxpbmcgd2l0aCB0cmFuc2Zvcm1lZCBlbGVtZW50c1xuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnaXMtdmlzaWJsZScpKSB7XG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoYFtkYXRhLWluZm8taG90c3BvdC1jb250YWluZXItaWQ9XCIke2lkfVwiXWApLmZvckVhY2goZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucGFyZW50Tm9kZS5hcHBlbmRDaGlsZChlbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gU2hvdyBjb250ZW50IHdoZW4gaG90c3BvdCBpcyBjbGlja2VkLlxuICAgICAgICB3cmFwcGVyLnF1ZXJ5U2VsZWN0b3IoJy5pbmZvLWhvdHNwb3QtaGVhZGVyJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0b2dnbGUpO1xuXG4gICAgICAgIGxldCBjbG9zZUljb24gPSBjb250ZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWhvdHNwb3QtY2xvc2VdJyk7XG4gICAgICAgIGlmIChjbG9zZUljb24pIHtcbiAgICAgICAgICAgIGNsb3NlSWNvbi5zZXRBdHRyaWJ1dGUoJ2RhdGEtaW5mby1ob3RzcG90LWlkJywgaG90c3BvdC5pZCk7XG4gICAgICAgICAgICBjbG9zZUljb24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0b2dnbGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUHJldmVudCB0b3VjaCBhbmQgc2Nyb2xsIGV2ZW50cyBmcm9tIHJlYWNoaW5nIHRoZSBwYXJlbnQgZWxlbWVudC5cbiAgICAgICAgLy8gVGhpcyBwcmV2ZW50cyB0aGUgdmlldyBjb250cm9sIGxvZ2ljIGZyb20gaW50ZXJmZXJpbmcgd2l0aCB0aGUgaG90c3BvdC5cbiAgICAgICAgdGhpcy5zdG9wVG91Y2hBbmRTY3JvbGxFdmVudFByb3BhZ2F0aW9uKHdyYXBwZXIpO1xuXG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh3cmFwcGVyKTtcblxuICAgICAgICByZXR1cm4gY29udGFpbmVyO1xuICAgIH1cblxuICAgIC8vIFByZXZlbnQgdG91Y2ggYW5kIHNjcm9sbCBldmVudHMgZnJvbSByZWFjaGluZyB0aGUgcGFyZW50IGVsZW1lbnQuXG4gICAgc3RvcFRvdWNoQW5kU2Nyb2xsRXZlbnRQcm9wYWdhdGlvbihlbGVtZW50KSB7XG4gICAgICAgIGxldCBldmVudExpc3QgPSBbJ3RvdWNoc3RhcnQnLCAndG91Y2htb3ZlJywgJ3RvdWNoZW5kJywgJ3RvdWNoY2FuY2VsJywgJ3doZWVsJywgJ21vdXNld2hlZWwnXTtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGV2ZW50TGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKGV2ZW50TGlzdFtpXSwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZpbmRTY2VuZUJ5SWQoaWQpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnNjZW5lcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKHRoaXMuc2NlbmVzW2ldLmRhdGEuaWQgPT09IGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2NlbmVzW2ldO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGZpbmRTY2VuZURhdGFCeUlkKGlkKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zY2VuZURhdGEuc2NlbmVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zY2VuZURhdGEuc2NlbmVzW2ldLmlkID09PSBpZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNjZW5lRGF0YS5zY2VuZXNbaV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGVudiBcbiAgICAgKi9cbiAgICBwcmVwYXJlRW52aXJvbm1lbnQoZW52KSB7XG5cbiAgICAgICAgaWYgKHdpbmRvdy5tYXRjaE1lZGlhKSB7XG4gICAgICAgICAgICBsZXQgc2V0TW9kZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAvLyBUaGUgdmlld3BvcnQgaXMsIGF0IG1vc3QgXG4gICAgICAgICAgICAgICAgaWYgKG1xbC5tYXRjaGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnZGVza3RvcCcpO1xuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ21vYmlsZScpO1xuICAgICAgICAgICAgICAgICAgICAvLyBkb2N1bWVudC5ib2R5LmlubmVySFRNTCA9ICdtb2JpbGUnO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnbW9iaWxlJyk7XG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgnZGVza3RvcCcpO1xuICAgICAgICAgICAgICAgICAgICAvLyBkb2N1bWVudC5ib2R5LmlubmVySFRNTCA9ICdkZXNrdG9wJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgbGV0IG1xbCA9IG1hdGNoTWVkaWEoJyhtYXgtd2lkdGg6IDUwMHB4KSwgKG1heC1oZWlnaHQ6IDUwMHB4KScpO1xuICAgICAgICAgICAgc2V0TW9kZSgpO1xuICAgICAgICAgICAgbXFsLmFkZExpc3RlbmVyKHNldE1vZGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKCdkZXNrdG9wJyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZW52O1xuICAgIH1cblxuXG4gICAgZ2V0VHJhbnNpdGlvblJvdGF0aW9uKGZyb20sIHRvKSB7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMucm90YXRpb25NYXBzLmZyb21bZnJvbS5pZF0udG9bdG8uaWRdO1xuICAgIH1cblxuICAgIC8vIENvdWxkIG1heWJlIGJlIG1hZGUgaW50byBhIGZpbGUgaW1wb3J0ZWQgaW4gdGhlIGJyb3dzZXIuIE9oIHdlbGwuXG4gICAgc2NlbmVUcmFuc2l0aW9uUm90YXRpb25NYXBwaW5nKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgJ2Zyb20nOiB7XG4gICAgICAgICAgICAgICAgJ3NjZW5lLTAnOiB7XG4gICAgICAgICAgICAgICAgICAgICd0byc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlcXVpcmVkIGZvciBmaXJzdCBsb2FkLiBGcm9tIDAgdG8gMCBpcyBzaWxseSBidXQgZ28gd2l0aCBpdC5cbiAgICAgICAgICAgICAgICAgICAgICAgICdzY2VuZS0wJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICd5YXcnOiAzLjgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BpdGNoJzogMC4yMjc5ODg4MDAyMjQ1NzYyNCxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAnc2NlbmUtMSc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAneWF3JzogLTIuODI3NDQ0ODk5NjI2MDQ0NixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGl0Y2gnOiAwLjA2MDEyOTMwNDg2NjU1MzIxXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICdzY2VuZS0xJzoge1xuICAgICAgICAgICAgICAgICAgICAndG8nOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnc2NlbmUtMCc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAneWF3JzogMC4xNDUyNTMzNDU4MDEwNDUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BpdGNoJzogMC4wN1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdzY2VuZS0yJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICd5YXcnOiAtMC4xNDk3MTU4NTQ4MTgzNzgzNSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGl0Y2gnOiAwLjA3XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3NjZW5lLTMnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3lhdyc6IDIuNjAyMTU3NDY1NzM3MzQwMyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGl0Y2gnOiAwLjA5OTYwNjYzMjMzNzQ5NzU2XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICdzY2VuZS0yJzoge1xuICAgICAgICAgICAgICAgICAgICAndG8nOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnc2NlbmUtMSc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAneWF3JzogMi40MzIxMzM1MTc1NzU2ODQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BpdGNoJzogMC4wN1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAnc2NlbmUtMyc6IHtcbiAgICAgICAgICAgICAgICAgICAgJ3RvJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ3NjZW5lLTEnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3lhdyc6IC0wLjQ0Njk0MDQyODIzNjI5OTQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BpdGNoJzogMC4wNzI0NDMxMTU0MDMwODk1NlxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdzY2VuZS00Jzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICd5YXcnOiAtMS4zOTk0ODY1MjkxODc2NzgxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwaXRjaCc6IDAuMDUxOTA3MDU4MDE1OTc0MTdcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAnc2NlbmUtNSc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAneWF3JzogMS40MDMyMTEyMDAxOTY1MjUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BpdGNoJzogMC4wN1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAnc2NlbmUtNCc6IHtcbiAgICAgICAgICAgICAgICAgICAgJ3RvJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ3NjZW5lLTMnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3lhdyc6IDEuMDYyMDM5MTk5OTAyMzAxMyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGl0Y2gnOiAwLjA3XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICdzY2VuZS01Jzoge1xuICAgICAgICAgICAgICAgICAgICAndG8nOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnc2NlbmUtMyc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAneWF3JzogLTAuNTIwMTM2NzYwMTcyMDU3NyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGl0Y2gnOiAwLjExNDE3MzAyMDYwNTcwNDc4XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG4iLCJjb25zdCBNYXJ6aXBhbm9WaWV3ZXIgPSByZXF1aXJlKCcuL01hcnppcGFub1ZpZXdlcicpO1xuXG5cbmNsYXNzIERlc2t0b3BWaWV3ZXIgZXh0ZW5kcyBNYXJ6aXBhbm9WaWV3ZXIge1xuXG4gICAgY29uc3RydWN0b3IocGFub0VsZW1lbnQpIHtcbiAgICAgICAgc3VwZXIoJ2Rlc2t0b3AnLCBwYW5vRWxlbWVudCwgd2luZG93LnNjZW5lRGF0YURlc2t0b3ApO1xuXG4gICAgICAgIHRoaXMuYXV0b3JvdGF0ZURhdGE7XG4gICAgICAgIHRoaXMuZmlyc3RMb2FkID0gdHJ1ZTtcblxuXG4gICAgICAgIHRoaXMuYXV0b3JvdGF0ZVRvZ2dsZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjYXV0b3JvdGF0ZVRvZ2dsZScpO1xuICAgICAgICB0aGlzLnNjZW5lTmFtZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdGl0bGVCYXIgLnNjZW5lTmFtZScpO1xuXG4gICAgICAgIGNvbnN0IGdyb3VwZWRTY2VuZURhdGEgPSB0aGlzLnNldHVwU2NlbmVCZWhhdmlvdXIodGhpcy5jcmVhdGVTY2VuZSwgdGhpcy5zd2l0Y2hTY2VuZSk7XG5cbiAgICAgICAgdGhpcy5zd2l0Y2hTY2VuZShncm91cGVkU2NlbmVEYXRhW3RoaXMuaW5pdGlhbFNjZW5lXSk7XG4gICAgfVxuXG4gICAgY3JlYXRlU2NlbmUodmlld2VyLCBzb3VyY2UsIGdlb21ldHJ5LCBkYXRhKSB7XG5cbiAgICAgICAgLy8gWzNdIENyZWF0ZSB0aGUgXCJleWVzXCIgb3Igdmlldy5cbiAgICAgICAgbGV0IGxpbWl0ZXIgPSB0aGlzLk1hcnppcGFuby5SZWN0aWxpbmVhclZpZXcubGltaXQudHJhZGl0aW9uYWwoXG4gICAgICAgICAgICB0aGlzLnNjZW5lRGF0YS5mYWNlU2l6ZSxcbiAgICAgICAgICAgIHRoaXMuZGVnMnJhZCgxMDApLFxuICAgICAgICAgICAgdGhpcy5kZWcycmFkKDEyMCkpO1xuICAgICAgICBjb25zdCB2aWV3ID0gbmV3IHRoaXMuTWFyemlwYW5vLlJlY3RpbGluZWFyVmlldyhkYXRhLmluaXRpYWxWaWV3UGFyYW1ldGVycywgbGltaXRlcik7XG5cbiAgICAgICAgLy8gVGhlIGN1cnJlbnQgc2NlbmUgZG9lcyBub3QgY2hhbmdlIHdoZW4gY3JlYXRpbmcgYSBzY2VuZSBpbiB0aGlzIHdheS5cbiAgICAgICAgY29uc3Qgc2NlbmUgPSB2aWV3ZXIuY3JlYXRlU2NlbmUoe1xuICAgICAgICAgICAgc291cmNlOiBzb3VyY2UsXG4gICAgICAgICAgICBnZW9tZXRyeTogZ2VvbWV0cnksXG4gICAgICAgICAgICB2aWV3OiB2aWV3LFxuICAgICAgICAgICAgcGluRmlyc3RMZXZlbDogdHJ1ZVxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBob3RzcG90Q29udGFpbmVyID0gc2NlbmUuaG90c3BvdENvbnRhaW5lcigpO1xuICAgICAgICAvLyBDcmVhdGUgbGluayBob3RzcG90cy5cbiAgICAgICAgZGF0YS5saW5rSG90c3BvdHMuZm9yRWFjaCgoaG90c3BvdCkgPT4ge1xuICAgICAgICAgICAgbGV0IGVsZW1lbnQgPSBzdXBlci5jcmVhdGVMaW5rSG90c3BvdEVsZW1lbnQuY2FsbCh0aGlzLCBob3RzcG90LCB0aGlzLnN3aXRjaFNjZW5lKTtcbiAgICAgICAgICAgIGhvdHNwb3RDb250YWluZXIuY3JlYXRlSG90c3BvdChlbGVtZW50LCB7IHlhdzogaG90c3BvdC55YXcsIHBpdGNoOiBob3RzcG90LnBpdGNoIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBDcmVhdGUgaW5mbyBob3RzcG90cy5cbiAgICAgICAgZGF0YS5pbmZvSG90c3BvdHMuZm9yRWFjaCgoaG90c3BvdCkgPT4ge1xuICAgICAgICAgICAgbGV0IGVsZW1lbnQgPSBzdXBlci5jcmVhdGVJbmZvSG90c3BvdEVsZW1lbnQoaG90c3BvdCwgdGhpcy5wYW5vRWxlbWVudCk7XG4gICAgICAgICAgICBob3RzcG90Q29udGFpbmVyLmNyZWF0ZUhvdHNwb3QoZWxlbWVudCwgeyB5YXc6IGhvdHNwb3QueWF3LCBwaXRjaDogaG90c3BvdC5waXRjaCB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHsgc2NlbmUsIHZpZXcsIGRhdGEgfTtcbiAgICB9XG5cbiAgICBzd2l0Y2hTY2VuZShzY2VuZSkge1xuXG5cbiAgICAgICAgY29uc3QgYWx0ZXJlZFZpZXdQYXJhbXMgPSB0aGlzLmZpcnN0TG9hZCA/XG4gICAgICAgICAgICBzY2VuZS5kYXRhLmluaXRpYWxWaWV3UGFyYW1ldGVycyA6XG4gICAgICAgICAgICB0aGlzLmdldFRyYW5zaXRpb25Sb3RhdGlvbih0aGlzLmN1cnJlbnREYXRhLCBzY2VuZS5kYXRhKTtcblxuICAgICAgICB0aGlzLmZpcnN0TG9hZCA9IGZhbHNlO1xuXG4gICAgICAgIHNjZW5lLnZpZXcuc2V0UGFyYW1ldGVycyhhbHRlcmVkVmlld1BhcmFtcyk7XG5cbiAgICAgICAgLy8gb3ZlcnJpZGVzIHRoZSB0aGlzLmN1cnJlbnRYWVogdmFyaWFibGVzLlxuICAgICAgICAvLyBJIG5lZWQgdGhvc2UgdmFyaWFibGVzIGludGFjdCBmb3IgYWx0ZXJpbmcgdGhlIGludGlhbCB2aWV3IHBhcmFtcyB0aG91Z2guIFNvIGRvIHRoaXMgYWZ0ZXIuXG4gICAgICAgIHRoaXMuY2FjaGVTY2VuZVZhcmlhYmxlcy5jYWxsKHRoaXMsIHNjZW5lKTtcbiAgICAgICAgc2NlbmUuc2NlbmUuc3dpdGNoVG8oKTtcbiAgICB9XG5cbn1cbiIsImNvbnN0IE1hcnppcGFub1ZpZXdlciA9IHJlcXVpcmUoJy4vTWFyemlwYW5vVmlld2VyJyk7XG5jb25zdCBEZXZpY2VPcmllbnRhdGlvblN0cmF0ZWd5ID0gcmVxdWlyZSgnLi9EZXZpY2VPcmllbnRhdGlvblN0cmF0ZWd5Jyk7XG5cbmNsYXNzIFZSVmlld2VyIGV4dGVuZHMgTWFyemlwYW5vVmlld2VyIHtcblxuICAgIGNvbnN0cnVjdG9yKHBhbm9FbGVtZW50KSB7XG5cbiAgICAgICAgc3VwZXIoJ21vYmlsZVZSJywgcGFub0VsZW1lbnQsIHdpbmRvdy5zY2VuZURhdGFWUik7XG5cbiAgICAgICAgdGhpcy5neXJvRW5hYmxlZDtcbiAgICAgICAgdGhpcy52aWV3aW5nVGltZW91dElEID0gbnVsbDtcbiAgICAgICAgdGhpcy5jdXJyZW50SG90c3BvdENhbmRpZGF0ZSA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5vcGVuZWRIb3RzcG90ID0gbnVsbDtcbiAgICAgICAgdGhpcy5wcmV2aW91c0ZyYW1lUm90YXRpb24gPSB7IHlhdzogMCwgcGl0Y2g6IDAsIHJvbGw6IDAgfTtcblxuICAgICAgICAvLyBGb3IgYWx0ZXJpbmcgdGhlIGluaXRpYWwgZGlyZWN0aW9uIGJhc2VkIHVwb24gcHJldmlvdXMgc2NlbmVcbiAgICAgICAgdGhpcy5zY2VuZUVudHJ5Vmlld0RpcmVjdGlvbiA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5sb29rVHJpZ2dlclRocmVzaG9sZCA9IDEuNSAqIDEwMDA7XG4gICAgICAgIHRoaXMub3BlblBvcHVwUmFkaWFuVGhyZXNoaG9sZCA9IHRoaXMuZGVnMnJhZCg1KTtcbiAgICAgICAgLy8gVGhpcyBpcyB0aGUgc2luZ2xlIGNvbHVtbiB0aHJlc2hvbGQsIGl0IGdldHMgZG91YmxlZCB3aGVuIGV4aXRpbmcgMiBjb2x1bW4gcG9wdXBzXG4gICAgICAgIHRoaXMuY2xvc2VQb3B1cEhvcml6b250YWxSYWRpYW5UaHJlc2hob2xkUGVyQ29sdW1uID0gdGhpcy5kZWcycmFkKDE1KTtcblxuICAgICAgICB0aGlzLm9yaWVudGF0aW9uTWV0aG9kSUQgPSAnZGV2aWNlT3JpZW50YXRpb24nO1xuXG4gICAgICAgIHRoaXMuZGV2aWNlT3JpZW50YXRpb25Db250cm9sRnVuY3Rpb24gPSBEZXZpY2VPcmllbnRhdGlvblN0cmF0ZWd5O1xuICAgICAgICB0aGlzLmRldmljZU9yaWVudGF0aW9uQ29udHJvbGxlcjtcblxuICAgICAgICBjb25zdCBncm91cGVkU2NlbmVEYXRhID0gdGhpcy5zZXR1cFNjZW5lQmVoYXZpb3VyKHRoaXMuY3JlYXRlU2NlbmUsIHRoaXMuc3dpdGNoU2NlbmUpO1xuXG4gICAgICAgIHRoaXMuc2V0dXBHeXJvQ29udHJvbHMoZ3JvdXBlZFNjZW5lRGF0YSk7XG5cbiAgICAgICAgdGhpcy5zd2l0Y2hTY2VuZShncm91cGVkU2NlbmVEYXRhW3RoaXMuaW5pdGlhbFNjZW5lXSk7XG4gICAgfVxuXG5cbiAgICAvLyBTaGFyZWQgc2lnbmF0dXJlIHdpdGggRGVza3RvcFZpZXdlci5jcmVhdGVTY2VuZSgpIGJ1dCBJIGRvbid0IHVzZSBpdCBhbGwuXG4gICAgLy8gVE9ETzogTWF5YmUgYWNjZXB0IG9wdHMgb2JqZWN0LlxuICAgIGNyZWF0ZVNjZW5lKHZpZXdlciwgc291cmNlLCBnZW9tZXRyeSwgZGF0YSkge1xuXG4gICAgICAgIGNvbnN0IHN0YWdlID0gdmlld2VyLnN0YWdlKCk7XG5cbiAgICAgICAgY29uc3QgbGVmdFJpZ2h0UmVjdHMgPSBbXG4gICAgICAgICAgICB7IHJlY3Q6IHsgcmVsYXRpdmVXaWR0aDogMC41LCByZWxhdGl2ZVg6IDAgfSB9LCAvLyBsZWZ0XG4gICAgICAgICAgICB7IHJlY3Q6IHsgcmVsYXRpdmVXaWR0aDogMC41LCByZWxhdGl2ZVg6IDAuNSB9IH0gIC8vIHJpZ2h0XG4gICAgICAgIF07XG5cbiAgICAgICAgY29uc3Qgb3B0cyA9IHtcbiAgICAgICAgICAgIHNvdXJjZTogc291cmNlLFxuICAgICAgICAgICAgZ2VvbWV0cnk6IGdlb21ldHJ5LFxuICAgICAgICAgICAgLy8gcGluRmlyc3RMZXZlbDogdHJ1ZSxcbiAgICAgICAgICAgIHRleHR1cmVTdG9yZU9wdHM6IHtcbiAgICAgICAgICAgICAgICBwcmV2aW91c2x5VmlzaWJsZUNhY2hlU2l6ZTogMzJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsYXllck9wdHM6IHtcbiAgICAgICAgICAgICAgICBlZmZlY3RzOiBudWxsXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgY29udGFpbmVycyA9IFtdO1xuICAgICAgICBjb25zdCBsYXllcnMgPSBbXTtcblxuICAgICAgICBjb25zdCBlbXB0eVZpZXcgPSBuZXcgdGhpcy5NYXJ6aXBhbm8uUmVjdGlsaW5lYXJWaWV3KGRhdGEuaW5pdGlhbFZpZXdQYXJhbWV0ZXJzKTtcbiAgICAgICAgY29uc3Qgc2NlbmUgPSB2aWV3ZXIuY3JlYXRlRW1wdHlTY2VuZSh7IHZpZXc6IGVtcHR5VmlldyB9KTtcblxuICAgICAgICBsZWZ0UmlnaHRSZWN0cy5mb3JFYWNoKChyZWN0LCBpbmRleCkgPT4ge1xuXG4gICAgICAgICAgICBvcHRzLmxheWVyT3B0cy5lZmZlY3RzID0gcmVjdDtcbiAgICAgICAgICAgIGNvbnN0IGxheWVyID0gc2NlbmUuY3JlYXRlTGF5ZXIob3B0cyk7XG5cbiAgICAgICAgICAgIC8vIFByb2JhYmx5IGRvbid0IG5lZWQgdGhpcyBidXQgaXQgbWlnaHQgYmUgdXNlZnVsIGZvciBkZWJ1Z2dpbmcgb3Igc3RhdGUgY2hlY2tzLlxuICAgICAgICAgICAgbGF5ZXIuZXllU2lkZSA9IGluZGV4ID09PSAwID8gJ2xlZnQnIDogJ3JpZ2h0JztcblxuICAgICAgICAgICAgLy8gQWRkIGhvdHNwb3RzLlxuICAgICAgICAgICAgY29uc3QgaG90c3BvdENvbnRhaW5lciA9IG5ldyB0aGlzLk1hcnppcGFuby5Ib3RzcG90Q29udGFpbmVyKFxuICAgICAgICAgICAgICAgIHZpZXdlci5kb21FbGVtZW50KCksXG4gICAgICAgICAgICAgICAgc3RhZ2UsXG4gICAgICAgICAgICAgICAgZW1wdHlWaWV3LFxuICAgICAgICAgICAgICAgIHZpZXdlci5yZW5kZXJMb29wKCksXG4gICAgICAgICAgICAgICAgcmVjdCk7XG5cbiAgICAgICAgICAgIC8vIENyZWF0ZSBsaW5rIGhvdHNwb3RzLlxuICAgICAgICAgICAgZGF0YS5saW5rSG90c3BvdHMuZm9yRWFjaCgoaG90c3BvdERhdGEpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gc3VwZXIuY3JlYXRlTGlua0hvdHNwb3RFbGVtZW50LmNhbGwodGhpcywgaG90c3BvdERhdGEsIHRoaXMuc3dpdGNoU2NlbmUpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuZGF0YXNldC5ob3RzcG90X3RhcmdldCA9IGhvdHNwb3REYXRhLnRhcmdldDtcbiAgICAgICAgICAgICAgICBob3RzcG90Q29udGFpbmVyLmNyZWF0ZUhvdHNwb3QoZWxlbWVudCwgeyB5YXc6IGhvdHNwb3REYXRhLnlhdywgcGl0Y2g6IGhvdHNwb3REYXRhLnBpdGNoIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIENyZWF0ZSBpbmZvIGhvdHNwb3RzLlxuICAgICAgICAgICAgZGF0YS5pbmZvSG90c3BvdHMuZm9yRWFjaCgoaG90c3BvdERhdGEpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoaG90c3BvdERhdGEuaGlkZUluVlIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOyAvLyBXZSdyZSBpbiBhIC5mb3JFYWNoIGZ1bmN0aW9uIHNvIHdlIHJldHVybiBpbnN0ZWFkIG9mIGNvbnRpbnVlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSBzdXBlci5jcmVhdGVJbmZvSG90c3BvdEVsZW1lbnQuY2FsbCh0aGlzLCBob3RzcG90RGF0YSwgbGF5ZXIpO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuZGF0YXNldC5ob3RzcG90X3RhcmdldCA9IGhvdHNwb3REYXRhLmlkO1xuICAgICAgICAgICAgICAgIGhvdHNwb3RDb250YWluZXIuY3JlYXRlSG90c3BvdChlbGVtZW50LCB7IHlhdzogaG90c3BvdERhdGEueWF3LCBwaXRjaDogaG90c3BvdERhdGEucGl0Y2ggfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gSGlkZSBhbGwgY29udGFpbmVycyBhdCBmaXJzdC5cbiAgICAgICAgICAgIGhvdHNwb3RDb250YWluZXIuaGlkZSgpO1xuICAgICAgICAgICAgY29udGFpbmVycy5wdXNoKGhvdHNwb3RDb250YWluZXIpO1xuICAgICAgICAgICAgLy8gUHJvYmFibHkgZG9uJ3QgbmVlZCB0byBjYWNoZSBsYXllcnMgaW4gYSBzY2VuZSBiYXNlZCBpbXBsZW1lbnRhdGlvbi5cbiAgICAgICAgICAgIC8vIHNjZW5lLmxpc3RMYXllcnMoKSBnaXZlcyB5b3UgdGhlIGxheWVycyBidXQgSSdtIHRvbyBwYXJhbm9pZCB0byBsZWF2ZSBpdCB0byBjaGFuY2UgYXQgdGhpcyBwb2ludC5cbiAgICAgICAgICAgIGxheWVycy5wdXNoKGxheWVyKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGRhdGEuaWQgPT09ICdzY2VuZS0wJykge1xuICAgICAgICAgICAgdGhpcy5zaG93SG90c3BvdFplcm8oY29udGFpbmVycyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTaG91bGQgcHJvYmFibHkgYWx0ZXIgdGhpcyB0byBnZXQgdGhlIGhvdHNwb3RzIHlhdyBhbmQgcGl0Y2ggZm9ybSB0aGUgY29udGFpbmVyLmxpc3RIb3RzcG90cygpLlxuXG4gICAgICAgIC8vIEFkZCBhIGxpdHRsZSBleHRyYSBkYXRhIGZvciB1c2luZyBpbiB2aWV3IGNvbGxpc2lvbiBjaGVja3MuXG5cbiAgICAgICAgY29uc3QgaW5mb0RhdGEgPSBkYXRhLmluZm9Ib3RzcG90c1xuICAgICAgICAgICAgLmZpbHRlcihpaCA9PiBPYmplY3Qua2V5cyhpaCkuaW5jbHVkZXMoJ2hpZGVJblZSJykgPT09IGZhbHNlKVxuICAgICAgICAgICAgLy8gV2UgZG9uJ3Qgd2FudCBjb2xsaXNpb25zIHdpdGggaG90c3BvdCAwXG4gICAgICAgICAgICAuZmlsdGVyKGloID0+IGloLmlkICE9PSAnMCcpXG4gICAgICAgICAgICAubWFwKGloID0+IHsgcmV0dXJuIHsgeWF3OiBpaC55YXcsIHBpdGNoOiBpaC5waXRjaCwgdGFyZ2V0OiBpaC5pZCwgY29sdW1uczogaWguY29sdW1ucyB8fCAxIH07IH0pO1xuXG4gICAgICAgIGNvbnN0IGxpbmtEYXRhID0gZGF0YS5saW5rSG90c3BvdHMubWFwKGxoID0+IHsgcmV0dXJuIHsgeWF3OiBsaC55YXcsIHBpdGNoOiBsaC5waXRjaCwgdGFyZ2V0OiBsaC50YXJnZXQgfTsgfSk7XG5cbiAgICAgICAgZGF0YS52ckNvbGxpc2lvbkRhdGEgPSBbLi4uaW5mb0RhdGEsIC4uLmxpbmtEYXRhXTtcblxuICAgICAgICAvLyBVc2VmdWwgbGF0ZXIgZm9yIGRlY2lkaW5nIHdoZXJlIHRvIGNlbnRlciB0aGUgdmlldyBvbiBzY2VuZSBjaGFuZ2UuXG4gICAgICAgIGRhdGEuZmlyc3RMb2FkID0gdHJ1ZTtcblxuICAgICAgICAvLyBHZXRzIGRlY29uc3RydWN0ZWQgb24gdGhlIG90aGVyIHNpZGUuXG4gICAgICAgIHJldHVybiB7IHNjZW5lOiBzY2VuZSwgdmlldzogZW1wdHlWaWV3LCBjb250YWluZXJzLCBsYXllcnMsIGRhdGEgfTtcbiAgICB9XG5cblxuICAgIHNob3dIb3RzcG90WmVybyhjb250YWluZXJzKSB7XG5cbiAgICAgICAgY29uc3QgeyBsZWZ0SG90c3BvdCwgcmlnaHRIb3RzcG90IH0gPSB0aGlzLmdldEhvdHNwb3RzRnJvbUhvdHNwb3RUYXJnZXQoY29udGFpbmVycywgJzAnKTtcbiAgICAgICAgY29uc3QgbGVmdEVsZW1lbnQgPSBsZWZ0SG90c3BvdC5kb21FbGVtZW50KCk7XG4gICAgICAgIHRoaXMuY2xpY2tJbmZvSG90c3BvdChsZWZ0RWxlbWVudCk7XG5cbiAgICB9XG5cblxuICAgIHN3aXRjaFNjZW5lKHNjZW5lKSB7XG5cbiAgICAgICAgLy8gU3dpdGNoIHRoZSBjdXJyZW50IGNvbnRhaW5lcnMuXG4gICAgICAgIC8vIEkgd291bGQgcHJlZmVyIHRvIGRpcmVjdGx5IHNob3cgYW5kIGhpZGUgZWxlbWVudHMgWzBdIGFuZCBbMV0gZnJvbSB0aGUgcmVzcGVjdGl2ZSBhcnJheXMuXG4gICAgICAgIC8vIEhvd2V2ZXIgd2hlbiBsb2FkaW5nIHRoZSBhcHAgYHRoaXMuY3VycmVudENvbnRhaW5lcnNgIGlzIGVtcHR5IHdoZW4gSSdtIHByZXR0eSBzdXJlIGl0IHNob3VsZCBiZSBwb3B1bGF0ZWQuXG4gICAgICAgIC8vIEkgY2FuIG9ubHkgYXNzdW1lIGl0J3MgYSBgdGhpc2AgaXNzdWUgb3Igc29tZSB3b25reSBzdGF0ZS4gU28gdG8gYmUgc2FmZSBJJ20gc3RpY2tpbmcgdG8gYEFycmF5LmZvckVhY2goKWBcbiAgICAgICAgdGhpcy5jdXJyZW50Q29udGFpbmVycy5mb3JFYWNoKGMgPT4ge1xuICAgICAgICAgICAgYy5oaWRlKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBzY2VuZS5jb250YWluZXJzLmZvckVhY2goYyA9PiB7XG4gICAgICAgICAgICBjLnNob3coKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQ2xlYXIgYW55IGhvdHNwb3QgbG9va2luZyB0aW1lcnMuXG4gICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnZpZXdpbmdUaW1lb3V0SUQpO1xuICAgICAgICB0aGlzLnZpZXdpbmdUaW1lb3V0SUQgPSBudWxsO1xuXG5cbiAgICAgICAgY29uc3QgYWx0ZXJlZFZpZXdQYXJhbXMgPSB0aGlzLmdldFRyYW5zaXRpb25Sb3RhdGlvbih0aGlzLmN1cnJlbnREYXRhLCBzY2VuZS5kYXRhKTtcblxuICAgICAgICBzY2VuZS52aWV3LnNldFBhcmFtZXRlcnMoYWx0ZXJlZFZpZXdQYXJhbXMpO1xuXG4gICAgICAgIC8vIG92ZXJyaWRlcyB0aGUgdGhpcy5jdXJyZW50WFlaIHZhcmlhYmxlcy4gXG4gICAgICAgIC8vIEkgbmVlZCB0aG9zZSB2YXJpYWJsZXMgaW50YWN0IGZvciBhbHRlcmluZyB0aGUgaW50aWFsIHZpZXcgcGFyYW1zIHRob3VnaC4gU28gZG8gdGhpcyBhZnRlci5cbiAgICAgICAgdGhpcy5jYWNoZVNjZW5lVmFyaWFibGVzLmNhbGwodGhpcywgc2NlbmUpO1xuXG4gICAgICAgIHNjZW5lLnNjZW5lLnN3aXRjaFRvKHt9LCAoKSA9PiB7XG4gICAgICAgICAgICAvLyBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCB3aGVuIHNjZW5lIHRyYW5zaXRpb24gZmluaXNoZXMuIE1heWJlIGl0IHdpbGwgYmUgdXNlZnVsIGxhdGVyP1xuICAgICAgICAgICAgLy8gRXNwZWNpYWxseSBpZiB3ZSB3YW50IHRvIGFsdGVyIHRoZSBpbml0aWFsIHZpZXcgcm90YXRpb24gYnkgb3VyIHByZXZpb3VzIHNjZW5lcyB2YWx1ZXMuXG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG5cbiAgICAvLyBDb3VsZCBwYXNzIGluIHRoZSBkZXZpY2VPcmllbnRhdGlvbkNvbnRyb2xGdW5jdGlvblxuICAgIHNldHVwR3lyb0NvbnRyb2xzKGdyb3VwZWRTY2VuZURhdGEpIHtcblxuICAgICAgICB0aGlzLk1hcnppcGFuby5kZXBlbmRlbmNpZXMuZXZlbnRFbWl0dGVyKHRoaXMuZGV2aWNlT3JpZW50YXRpb25Db250cm9sRnVuY3Rpb24pO1xuICAgICAgICB0aGlzLmRldmljZU9yaWVudGF0aW9uQ29udHJvbGxlciA9IG5ldyB0aGlzLmRldmljZU9yaWVudGF0aW9uQ29udHJvbEZ1bmN0aW9uKCk7XG4gICAgICAgIC8vIFJlZ2lzdGVyIHRoZSBjdXN0b20gY29udHJvbCBtZXRob2QuICBcbiAgICAgICAgY29uc3QgaW5zdGFudEVuYWJsZSA9IHRydWU7XG4gICAgICAgIHRoaXMudmlld2VyLmNvbnRyb2xzKCkucmVnaXN0ZXJNZXRob2QodGhpcy5vcmllbnRhdGlvbk1ldGhvZElELCB0aGlzLmRldmljZU9yaWVudGF0aW9uQ29udHJvbGxlciwgaW5zdGFudEVuYWJsZSk7XG5cbiAgICAgICAgdGhpcy5kZXZpY2VPcmllbnRhdGlvbkNvbnRyb2xsZXIuYWRkRXZlbnRMaXN0ZW5lcigndXBkYXRlZFlhd1BpdGNoUm9sbCcsIChfLCByb3RhdGlvbikgPT4ge1xuXG4gICAgICAgICAgICAvLyBpZiAodGhpcy5zd2l0Y2hpbmdTY2VuZXMpIHsgcmV0dXJuOyB9XG4gICAgICAgICAgICB0aGlzLmNvbXB1dGVMb29rRGlyZWN0aW9uLmNhbGwodGhpcywgcm90YXRpb24sIHRoaXMuY3VycmVudFNjZW5lLCB0aGlzLmN1cnJlbnRWaWV3KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gRm9yIHRlc3RpbmcgdmlldyBkaXJlY3Rpb24gb24gZGVza3RvcCBvbmx5XG4gICAgICAgIC8vIFRoaXMgaXMgYWxzbyB1c2VmdWwgaWYgeW91IHdhbnQgdG8ga25vdyB0aGUgeWF3IGFuZCBwaXRjaCBmb3IgcGxhY2luZyBkZXNrdG9wXG4gICAgICAgIC8vIGdyb3VwZWRTY2VuZURhdGEuZm9yRWFjaChnc2QgPT4ge1xuICAgICAgICAvLyAgICAgZ3NkLnZpZXcuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKCkgPT4ge1xuXG4gICAgICAgIC8vICAgICAgICAgdGhpcy5jb21wdXRlTG9va0RpcmVjdGlvbi5jYWxsKHRoaXMsIG51bGwsIHRoaXMuY3VycmVudFNjZW5lLCB0aGlzLmN1cnJlbnRWaWV3KTtcbiAgICAgICAgLy8gICAgIH0pO1xuICAgICAgICAvLyB9KVxuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogSSB3b3JyeSB0aGF0IHRoaXMgaXNuJ3QgdGFyZ2V0dGluZyB0aGUgcmlnaHQgZWxlbWVudHMuLi4uXG4gICAgICogXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBvbiBcbiAgICAgKi9cbiAgICBzZXRUaW1lckNsYXNzKG9uKSB7XG4gICAgICAgIHRoaXMucGFub0VsZW1lbnQuY2xhc3NMaXN0LnRvZ2dsZSgnaXMtb3BlbmluZycsIG9uKTtcbiAgICB9XG5cblxuICAgIGNsaWNrSW5mb0hvdHNwb3QoZWxlbWVudCkge1xuICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5pbmZvLWhvdHNwb3QtaGVhZGVyJykuY2xpY2soKTtcbiAgICB9XG5cblxuICAgIGNsaWNrTGlua0hvdHNwb3QoZWxlbWVudCkge1xuICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5saW5rLWhvdHNwb3QnKS5jbGljaygpO1xuICAgIH1cblxuXG4gICAgLy8gXG4gICAgLyoqXG4gICAgICogQ2xhbXAgYSByYWRpYW4gcm90YXRpb24gYmV0d2VlbiAtUGkgYW5kIFBpLlxuICAgICAqIDAgaXMgbG9va2luZyBkaXJlY3RseSBhdCB0aGUgc3BvdC5cbiAgICAgKiBOZWdhdGl2ZSByZXN1bHRzIGFyZSBtb3ZpbmcgbGVmdC5cbiAgICAgKiBQb3NpdGl2ZSByZXN1bHRzIGFyZSBtb3ZpbmcgcmlnaHQuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHJvdGF0aW9uIFxuICAgICAqL1xuICAgIGNsYW1wT3ZlcmZsb3dSb3RhdGlvbihyb3RhdGlvbikge1xuICAgICAgICBjb25zdCBwaTIgPSAoTWF0aC5QSSAqIDIpO1xuICAgICAgICBsZXQgcmFkaWFuID0gKHJvdGF0aW9uICsgTWF0aC5QSSkgJSBwaTI7XG5cbiAgICAgICAgaWYgKHJhZGlhbiA8IDApIHJhZGlhbiArPSBwaTI7XG5cbiAgICAgICAgcmV0dXJuIHJhZGlhbiAtIE1hdGguUEk7XG4gICAgfVxuXG5cbiAgICBtaW5pbXVtTG9va0F0Qm91bmRzKHNwb3QsIHBhcmFtcykge1xuXG4gICAgICAgIGNvbnN0IHlhd0RpZmYgPSBzcG90LnlhdyAtIHBhcmFtcy55YXc7XG4gICAgICAgIGNvbnN0IHBpdGNoRGlmZiA9IHNwb3QucGl0Y2ggLSBwYXJhbXMucGl0Y2g7XG4gICAgICAgIGNvbnN0IGxvb2tBdFVwcGVyQm91bmQgPSB5YXdEaWZmIDwgdGhpcy5vcGVuUG9wdXBSYWRpYW5UaHJlc2hob2xkICYmIHBpdGNoRGlmZiA8IHRoaXMub3BlblBvcHVwUmFkaWFuVGhyZXNoaG9sZDtcbiAgICAgICAgY29uc3QgbG9va0F0TG93ZXJCb3VuZCA9IHlhd0RpZmYgPiAtdGhpcy5vcGVuUG9wdXBSYWRpYW5UaHJlc2hob2xkICYmIHBpdGNoRGlmZiA+IC10aGlzLm9wZW5Qb3B1cFJhZGlhblRocmVzaGhvbGQ7XG5cbiAgICAgICAgcmV0dXJuIHsgeWF3RGlmZiwgcGl0Y2hEaWZmLCBsb29rQXRVcHBlckJvdW5kLCBsb29rQXRMb3dlckJvdW5kIH07XG4gICAgfVxuXG5cbiAgICBtaW5pbXVtTG9va0F3YXlCb3VuZHMoc3BvdCwgcGFyYW1zKSB7XG5cbiAgICAgICAgLy8gR290dGEgbm9ybWFsaXNlIHRoZSB5YXcgZGlmZiBhIGJpdFxuICAgICAgICBjb25zdCB5YXdEaWZmID0gdGhpcy5jbGFtcE92ZXJmbG93Um90YXRpb24oc3BvdC55YXcgLSBwYXJhbXMueWF3KTtcblxuICAgICAgICAvLyA+IDwgaXMgZmxpcHBlZCBmcm9tIHRoZSB7bG9va0F0fSBib3VuZHNcbiAgICAgICAgLy8gd2UncmUgdHJ5aW5nIHRvIGdldCBGVVJUSEVSIEFXQVkgdG8gY2xvc2UsIG5vdCBDTE9TRSBFTk9VR0ggdG8gb3BlblxuICAgICAgICBjb25zdCBsb29rQXdheU1pbmltdW1VcHBlckJvdW5kID0geWF3RGlmZiA+IHRoaXMuY2xvc2VQb3B1cEhvcml6b250YWxSYWRpYW5UaHJlc2hob2xkUGVyQ29sdW1uICogc3BvdC5jb2x1bW5zO1xuICAgICAgICBjb25zdCBsb29rQXdheU1pbmltdW1Mb3dlckJvdW5kID0geWF3RGlmZiA8IC10aGlzLmNsb3NlUG9wdXBIb3Jpem9udGFsUmFkaWFuVGhyZXNoaG9sZFBlckNvbHVtbiAqIHNwb3QuY29sdW1ucztcblxuICAgICAgICByZXR1cm4geyB5YXdEaWZmLCBsb29rQXdheU1pbmltdW1VcHBlckJvdW5kLCBsb29rQXdheU1pbmltdW1Mb3dlckJvdW5kIH07XG4gICAgfVxuXG5cbiAgICAvLyBCeSB1c2luZyBwcm90b3R5cGUuY2FsbCgpIHt0aGlzfSB3aWxsIGJlIHRoZSBub3JtYWwgY2xhc3Mgc2NvcGUgYW5kIGhhdmUgYWNjZXNzIHRvIGNsYXNzIHZhcmlhYmxlcy5cbiAgICBjb21wdXRlTG9va0RpcmVjdGlvbihyb3RhdGlvbiwgY3VycmVudFNjZW5lLCBjdXJyZW50Vmlldykge1xuXG4gICAgICAgIC8vIHBpdGNoLCByb2xsIGFuZCB5YXcgaW4gcmFkaWFuc1xuICAgICAgICBjb25zdCBwYXJhbXMgPSBjdXJyZW50Vmlldy5wYXJhbWV0ZXJzKCk7XG5cbiAgICAgICAgLy8gTm90aGluZyBzZWxlY3RlZCBvciBjdXJyZW50bHkgc2VsZWN0aW5nLiBHbyBmaW5kIGEgaG90c3BvdFxuICAgICAgICBpZiAoIXRoaXMuY3VycmVudEhvdHNwb3RDYW5kaWRhdGUgJiYgIXRoaXMub3BlbmVkSG90c3BvdCkge1xuICAgICAgICAgICAgLy8gSGF2ZW4ndCBmb3VuZCBhbmQgb3BlbmVkIGEgaG90c3BvdCB5ZXQuXG4gICAgICAgICAgICAvLyBMZXRzIGdvIGxvb2tpbmcgZm9yIG9uZS5cbiAgICAgICAgICAgIGxldCBob3RzcG90cyA9IHRoaXMuY3VycmVudERhdGEudnJDb2xsaXNpb25EYXRhO1xuXG4gICAgICAgICAgICAvLyBMb29wcyB0aGUgaG90c3BvdHMsIGxvb2sgZm9yIG9uZSB3aXRoIGEgY2xvc2UgZW5vdWdoIHBpdGNoIGFuZCB5YXcsIHNlbGVjdCB0aGF0IGFzIHRoZSBjYW5kaWRhdGVcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaG90c3BvdHMubGVuZ3RoOyBpKyspIHtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRIb3RzcG90Q2FuZGlkYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IHNwb3QgPSBob3RzcG90c1tpXTtcbiAgICAgICAgICAgICAgICAvLyBjb21wdXRlIGEgcm90YXRpb24gZGlmZmVyZW5jZVxuICAgICAgICAgICAgICAgIGNvbnN0IHsgeWF3RGlmZiwgcGl0Y2hEaWZmLCBsb29rQXRVcHBlckJvdW5kLCBsb29rQXRMb3dlckJvdW5kIH0gPSB0aGlzLm1pbmltdW1Mb29rQXRCb3VuZHMoc3BvdCwgcGFyYW1zKTtcblxuICAgICAgICAgICAgICAgIC8vIElmIHRoYXQgZGlmZmVyZW5jZSBpcyB3aXRoaW4gYSB0b2xlcmFuY2UgdGhlbiBpbnRlcmFjdCB3aXRoIHRoZSBlbGVtZW50LlxuICAgICAgICAgICAgICAgIGlmIChsb29rQXRVcHBlckJvdW5kICYmIGxvb2tBdExvd2VyQm91bmQpIHtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRIb3RzcG90Q2FuZGlkYXRlID0gc3BvdDtcblxuICAgICAgICAgICAgICAgICAgICAvLyBIYXZlIHdlIGJlZ3VuIGxvb2tpbmcgYXQgYW55IGhvdHNwb3QgeWV0P1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMudmlld2luZ1RpbWVvdXRJRCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFRpbWVyQ2xhc3ModHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmlld2luZ1RpbWVvdXRJRCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBsZWZ0SG90c3BvdCwgcmlnaHRIb3RzcG90IH0gPSB0aGlzLmdldEhvdHNwb3RzRnJvbUhvdHNwb3RUYXJnZXQodGhpcy5jdXJyZW50Q29udGFpbmVycywgdGhpcy5jdXJyZW50SG90c3BvdENhbmRpZGF0ZS50YXJnZXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxlZnRFbGVtZW50ID0gbGVmdEhvdHNwb3QuZG9tRWxlbWVudCgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRUaW1lckNsYXNzKGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZpZXdpbmdUaW1lb3V0SUQgPSBudWxsO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5jdXJyZW50SG90c3BvdENhbmRpZGF0ZSA9IG51bGw7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJcyBpdCBhbiBsaW5rIG9yIGluZm8gaG90c3BvdD9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobGVmdEVsZW1lbnQuZGF0YXNldC5ob3RzcG90X3RhcmdldC5pbmNsdWRlcygnc2NlbmUnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9wZW5lZEhvdHNwb3QgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsaWNrTGlua0hvdHNwb3QobGVmdEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vcGVuZWRIb3RzcG90ID0gc3BvdDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGlja0luZm9Ib3RzcG90KGxlZnRFbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLmxvb2tUcmlnZ2VyVGhyZXNob2xkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG4gICAgICAgIC8vIFdlIGhhdmUgYSBjYW5kaWRhdGUgYW5kIHdlJ3JlIGN1cnJlbnRseSBjb3VudGluZyBkb3duLiBDaGVjayBmb3IgbG9vayBhd2F5IGR1cmluZyB0aGlzIHRpbWUuXG4gICAgICAgIGVsc2UgaWYgKHRoaXMuY3VycmVudEhvdHNwb3RDYW5kaWRhdGUgJiYgIXRoaXMub3BlbmVkSG90c3BvdCkge1xuXG4gICAgICAgICAgICBjb25zdCBzcG90ID0gdGhpcy5jdXJyZW50SG90c3BvdENhbmRpZGF0ZTtcblxuICAgICAgICAgICAgLy8gY29tcHV0ZSBhIHJvdGF0aW9uIGRpZmZlcmVuY2VcbiAgICAgICAgICAgIGNvbnN0IHsgeWF3RGlmZiwgcGl0Y2hEaWZmLCBsb29rQXRVcHBlckJvdW5kLCBsb29rQXRMb3dlckJvdW5kIH0gPSB0aGlzLm1pbmltdW1Mb29rQXRCb3VuZHMoc3BvdCwgcGFyYW1zKTtcblxuICAgICAgICAgICAgLy8gQXJlIHdlIG5vdyBsb29raW5nIGF3YXkgZnJvbSB0aGUgY2FuZGlkYXRlP1xuICAgICAgICAgICAgaWYgKCFsb29rQXRVcHBlckJvdW5kIHx8ICFsb29rQXRMb3dlckJvdW5kKSB7XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudmlld2luZ1RpbWVvdXRJRCk7XG4gICAgICAgICAgICAgICAgLy8gVGhlIGNsZWFyVGllbW91dCBmdW5jdGlvbiBkb2Vzbid0IHJlc2V0IHRoZSB2YXJpYWJsZSB0byBzb21ldGhpbmcgc2FmZS5cbiAgICAgICAgICAgICAgICB0aGlzLnZpZXdpbmdUaW1lb3V0SUQgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMub3BlbmVkSG90c3BvdCA9IG51bGw7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50SG90c3BvdENhbmRpZGF0ZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRUaW1lckNsYXNzKGZhbHNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gQSBob3RzcG90IGhhcyBiZWVuIG9wZW5lZCwgbm93IHN0YXJ0IHRyeWluZyB0byBjbG9zZSBpdC5cbiAgICAgICAgZWxzZSBpZiAodGhpcy5vcGVuZWRIb3RzcG90KSB7XG5cbiAgICAgICAgICAgIGNvbnN0IHNwb3QgPSB0aGlzLm9wZW5lZEhvdHNwb3Q7XG5cbiAgICAgICAgICAgIGNvbnN0IHsgeWF3RGlmZiwgbG9va0F3YXlNaW5pbXVtVXBwZXJCb3VuZCwgbG9va0F3YXlNaW5pbXVtTG93ZXJCb3VuZCB9ID0gdGhpcy5taW5pbXVtTG9va0F3YXlCb3VuZHMoc3BvdCwgcGFyYW1zKTtcblxuICAgICAgICAgICAgaWYgKGxvb2tBd2F5TWluaW11bUxvd2VyQm91bmQgfHwgbG9va0F3YXlNaW5pbXVtVXBwZXJCb3VuZCkge1xuXG4gICAgICAgICAgICAgICAgY29uc3QgeyBsZWZ0SG90c3BvdCwgcmlnaHRIb3RzcG90IH0gPSB0aGlzLmdldEhvdHNwb3RzRnJvbUhvdHNwb3RUYXJnZXQodGhpcy5jdXJyZW50Q29udGFpbmVycywgc3BvdC50YXJnZXQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGxlZnRFbGVtZW50ID0gbGVmdEhvdHNwb3QuZG9tRWxlbWVudCgpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5jbGlja0luZm9Ib3RzcG90KGxlZnRFbGVtZW50KTtcbiAgICAgICAgICAgICAgICAvLyBSZXNldCB2YXJpb3VzIGNhY2hlZCB2YXJpYWJsZXNcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy52aWV3aW5nVGltZW91dElEKTtcbiAgICAgICAgICAgICAgICB0aGlzLnZpZXdpbmdUaW1lb3V0SUQgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMub3BlbmVkSG90c3BvdCA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRIb3RzcG90c0Zyb21Ib3RzcG90VGFyZ2V0KGNvbnRhaW5lcnMsIHRhcmdldCkge1xuXG4gICAgICAgIGNvbnN0IGhvdHNwb3RzID0gWy4uLmNvbnRhaW5lcnNbMF0ubGlzdEhvdHNwb3RzKCldO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaG90c3BvdHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGQgPSBob3RzcG90c1tpXS5kb21FbGVtZW50KCk7XG5cbiAgICAgICAgICAgIGlmIChkLmRhdGFzZXQuaG90c3BvdF90YXJnZXQgPT0gdGFyZ2V0KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbGVmdCA9IGhvdHNwb3RzW2ldO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJpZ2h0ID0gY29udGFpbmVyc1sxXS5saXN0SG90c3BvdHMoKVtpXTtcbiAgICAgICAgICAgICAgICByZXR1cm4geyBsZWZ0SG90c3BvdDogbGVmdCwgcmlnaHRIb3RzcG90OiByaWdodCB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gVGhyb3cgYW4gZXJyb3IsIGRvbid0IGNhdGNoIGl0LiBUaGlzIGlzIGEgY3Jhc2hpbmcgZXJyb3IuXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ25vIGhvdHNwb3QgZm91bmQ/Jyk7XG4gICAgfVxuXG59XG4iXX0=
